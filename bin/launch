#!/usr/bin/env bash

#------------------------------------------------------------------------------
# Source helper functions
#------------------------------------------------------------------------------

source lib/misc.sh

#------------------------------------------------------------------------------
# Pull through image cache
#------------------------------------------------------------------------------

docker start registry-docker.io || docker run -d -p 5001:5000 \
  -e REGISTRY_PROXY_REMOTEURL=https://registry-1.docker.io \
  --restart always \
  --name registry-docker.io \
  registry:2

#------------------------------------------------------------------------------
# Create two k8s clusters
#------------------------------------------------------------------------------

launch_k8s kube-01 2>/dev/null || multipass start kube-01
launch_k8s kube-02 2>/dev/null || multipass start kube-02

#------------------------------------------------------------------------------
# Setup KUBECONFIG
#------------------------------------------------------------------------------

#mkdir -p /tmp/${MASTER}
#multipass mount /tmp/${MASTER} ${MASTER}:/mnt/workstation 2>/dev/null

